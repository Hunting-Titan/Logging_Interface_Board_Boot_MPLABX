<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Logging Panel  Interface Board: Description</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Logging Panel  Interface Board<span id="projectnumber">&#160;1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Description </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The firmware is written in C using the Microchip MPLAB IDE. The MPLAB Harmony Configurator is also used to generate code to configure the various peripherals and settings needed for the microcontroller to function correctly. The code is written to the MISRA 2012 standard and has been static tested using the LDRA test software. All of the functions used are arranged as tasks. These tasks are state machines that govern the operation of a given task. All tasks are broken up into appropriate states that allow other tasks to operate while waiting for an operation to complete. Some states make use of local functions to make the state machine easier to view. When the system powers up, it goes through a self test and an initialization process and ensures that all functions are operational. The system is then ready for use.</p>
<p><b>MAIN:</b></p>
<p>The starting point of the program. The system tests are performed before any initialization takes place. After the system tests, the peripherals and <br  />
 application initializations take place. Finally, the application tasks are used in a while loop.</p>
<p>The tasks monitor currents and voltages at various points, provide a means for communicating with PerfSwitches or similar devices, as well as responding to commands from a host.</p>
<p>The primary communication port to the host is USB. The system is configured to use a WinUSB connection. A secondary UART connection is also available for testing and debugging code. All commands use a CRC to validate the command string and response.</p>
<p>The system uses two power supplies. One is a communication supply used to power the PerfSwitch or similar devices when they being tested or configured. The second is a shooting power supply that is used to provide the energy needed to ignite a detonator while a tool string is downhole. The voltage and current for these supplies is monitored and the supplies can be turned off if an overvoltage or overcurrent condition occurs. The supplies can also be set to a given voltage and can be turned on and off as needed.</p>
<p><b>TIMER:</b></p>
<p>The TIMER task is used to maintain a 100uS timer tick. This task uses the TIMER 1 instance. This tick is then used to generate 1mS, 10mS, 100mS and 1s ticks. Timer ticks needed for other tasks are generated here.</p>
<p><b>SWITCH:</b></p>
<p>The SWITCH task monitors the front panel switches and generates commands to actuate relays as required. Logic is also in place to prevent some switch actions based on other switch actions or positions. The switch positions are stored for retrieval from the host.</p>
<p><b>COMM:</b></p>
<p>The COMM task handles communications to the host either via a UART or USB connection. Once a command is received, it is validated. If it is a valid command, flags are set to begin processing the command and this machine waits for the command to complete. Once the command processing is completed, the response is sent back to the host via the same connection the command was received.Once a response has been sent, this machine waits for another command.</p>
<p><b>COMMAND:</b></p>
<p>The COMMAND task responds when the COMM task sets a flag after receiving a valid command from the host. The CRC of the command is checked and if it is valid, the command is executed. There are two different types of commands that can be sent, protocol A. Protocol A commands are commands for controlling the LIB or the system itself. Some protocol A commands are involved in the automated operation of the PIB. These protocols are defined elsewhere. Once a command is executed, a response is generated for transmission back to the host. Afterwards, another command can be executed. Only one command can be processed at a time.</p>
<p><b>USB:</b></p>
<p>The USB task handles USB communications from the host. It uses a WinUSB connection and operates at full speed. The full speed limitation is due to the hardware isolated USB connection. The data from the USB transfers are sent to the Rx and Tx Fifos and then controlled by the COMM task to process the command.</p>
<p><b>UART:</b></p>
<p>The UART task handles UART communications from the host. This was used during the initial code development. The settings are 115200-N-8-1. The data from the UART transfers are sent to the Rx and Tx Fifos and then controlled by the COMM task to process the command. This port is now used to update the system firmware in a bootloader.</p>
<p><b>CF:</b></p>
<p>The CF task monitors the wire line current when the panel is in the ARM_CF function. Once started, the CF operation is governed by the new data flag generated in the ADC portion of system_interrupt.c.</p>
<p><b>SYSTEM_OKAY:</b></p>
<p>This task checks the results of the Class B system tests performed by the main controller and the HVPS self test function. If either one of the system tests fail, the DUMP LED is turned on to indicate a failure.</p>
<p><b>crc:</b></p>
<p>These functions calculate the CRC used to verify communications between the host and the panel as well as the panel and the PerfSwitches. <br  />
</p>
<p><b>fifo:</b></p>
<p>These functions transfer data into receive and transmit Fifos. These Fifos ensure data is handled correctly to minimize data transmission errors.</p>
<p><b>statusst:</b></p>
<p>These functions handle setting and clearing the status bits for the panel as well as arranging the status bits for both the panel and PerfSwitches for transmission to the host. * <br  />
</p>
<p><b>TEST:</b></p>
<p>The TEST task performs some of the Class B safety test on the controller prior to the controller being initialize for use in the program. This test is only performed at startup. The result of this test is used in the SYSTEM_OKAY task.</p>
<p><b>GAMMA:</b></p>
<p>This task tracks the counts from the gamma detector. When a transition from the gamma detector is detected, a flag is set in system interrupt. One gamma count causes two interrupts. This is accounted for. The count is then transferred to the REPORT array for later transmission to the host. The gamma gain circuit can be adjusted by pushing the STATUS LED button. Ten gain choices are available. The choice is stored in the controller memory. See <a class="el" href="nvm__fs_8c.html">nvm_fs.c</a>.</p>
<p><b>GPT:</b></p>
<p>This task decodes the Titan telemetry message from the GPT tool. Sync pulses occur every 64mS to indicate the start of a new data string. 21 'channels' of data can be sent along with a checksum and tool version number. The tool uses Titan telemetry protocol. Each bit uses a 200uS window. A data pulse received represents a 'one' and no data pulse represents a 'zero'. The states are configured so that other system tasks can be maintained while these tasks are waiting for an event to occur.</p>
<p><b>HIGH SIDE:</b></p>
<p>This task monitor the HST communication when the front panel knob is in the HIGH SIDE position. A UART is configured for 20KBaud N-8-1 to receive the data. These functions monitor the HST communication. A UART is configured to receive the data. This machine reads data from the UART and puts it to the RxFifo for later use. The first 30 transmissions from the HSI tool are the 'Sign On' data that includes the Tool ID and firmware version. All transmissions afterwards are the tool data values.</p>
<p><b> NVM:</b></p>
<p>This task stores and retrieves the gamma gain setting. The gain setting is determined by pushing the STATUS LED button. Doing so toggles the gamma gain circuit through ten settings.The setting is stored with each switch push. The setting is retrieved at power on. It uses the the FAT image created in <a class="el" href="nvm__disk__images_8c.html">nvm_disk_images.c</a> to store the STATUS LED switch count. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
